# نام ورک‌فلو که در تب Actions گیت‌هاب نمایش داده می‌شود
name: Generate Shadowsocks Configs

# تریگرها: چه زمانی این ورک‌فلو اجرا شود
on:
  # 1. اجرای زمان‌بندی شده: هر 6 ساعت یکبار (می‌توانید زمان را تغییر دهید)
  schedule:
    - cron: '0 */6 * * *'

  # 2. اجرای دستی: دکمه "Run workflow" در تب Actions گیت‌هاب فعال می‌شود
  workflow_dispatch:

  # 3. اجرای خودکار: هر بار که کدی به شاخه main پوش شود (برای تست اولیه مفید است)
  push:
    branches:
      - main

# تعریف جاب‌ها (مراحل اجرایی)
jobs:
  build:
    # استفاده از آخرین نسخه اوبونتو برای اجرا
    runs-on: ubuntu-latest

    steps:
      # مرحله 1: دریافت کد از ریپازیتوری شما
      - name: Check out repository code
        uses: actions/checkout@v4

      # مرحله 2: نصب و راه‌اندازی پایتون
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # می‌توانید نسخه پایتون را تغییر دهید

      # مرحله 3: نصب پکیج‌های مورد نیاز از فایل requirements.txt
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # مرحله 4: اجرای اسکریپت اصلی برای تولید فایل shadowsocks.txt
      - name: Run script to generate configs
        run: python main.py

      # مرحله 5: کامیت و پوش کردن فایل shadowsocks.txt در ریپازیتوری
      - name: Commit and push if changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # پیام کامیت
          commit_message: 'ci: auto-update shadowsocks configs'
          # فقط فایل shadowsocks.txt را کامیت کن
          file_pattern: 'shadowsocks.txt'
          # اطلاعات نویسنده کامیت
          commit_user_name: 'GitHub Actions Bot'
          commit_user_email: 'actions@github.com'
